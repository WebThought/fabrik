var FbTags=new Class({options:{rowid:"",id:0},Extends:FbElement,initialize:function(b,a){this.parent(b,a);if(this.options.editable){this.setUp()}},setUp:function(){jQuery("#"+this.options.element).chosen({disable_search_threshold:10,allow_single_deselect:true});this.sel=jQuery("#"+this.options.element).ajaxChosen({type:"GET",url:Fabrik.liveSite+"index.php?option=com_tags&task=tags.searchAjax",dataType:"json",jsonTermKey:"like",afterTypeDelay:"500",minTermLength:"3"},function(c){var b=[];jQuery.each(c,function(d,e){b.push({value:e.value,text:e.text})});return b});var a=this.sel;this.sel.on("change",function(c){var b=jQuery(a).find("option");jQuery(a.data().chosen.results_data).each(function(){jQuery(b[this.options_index]).attr("selected",this.selected)})});this.watchNew()},watchNew:function(){var d="#fabrik#",a=jQuery(this.getContainer()),c=this.options.element,b,e=a.find(".search-field input");e.keydown(function(j){if(this.value.length>=3&&(j.which===13||j.which===188)){var i=a.find("li.active-result.highlighted").first();if(j.which===13&&i.text()!==""){var f=d+i.text();a.find("option").filter(function(){return jQuery(this).val()===f}).remove();b=a.find("option").filter(function(){return jQuery(this).html()===i.text()});b.attr("selected","selected")}else{var h=this.value;b=a.find("option").filter(function(){return jQuery(this).html()===h});if(b.text()!==""){b.attr("selected","selected")}else{var g=jQuery("<option>");g.text(this.value).val(d+this.value);g.attr("selected","selected");a.find("select").append(g)}}this.value="";jQuery("#"+c).trigger("liszt:updated");j.preventDefault()}})},cloned:function(a){Fabrik.fireEvent("fabrik.tags.update",this);this.parent(a);this.setUp()}});